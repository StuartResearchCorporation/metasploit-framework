**Polymorphic ARM Assembly Encoder**

**ARMR Product Backlog**

## **Team Members**

Abdalla Almazmi, Samuel Fellers, Jacob Stuart, Rishabh Saxena, Chris Von Hoene

**Problem Statement**

Security researchers use encoders as a means to remove "bad" characters from exploits and to circumvent intrusion detection systems. There are currently encoders that work well with Metasploit for many languages and architectures, but there are no encoders currently that work with ARM assembly. Our encoder will mimic the existing Shikata Ga Nai encryption technique as a polymorphic xor additive feedback solution.

**Background Information**

Shikata Ga Nai is currently the only existing x86 encoder, running on the Metasploit framework with an "excellent" rating. The existing implementation of Shikata Ga Nai is a polymorphic additive XOR  encoder. Code is generated by encrypting a payload and concatenating it with a polymorphic decoder stub, which decrypts the payload at runtime. The encoder works by XORing a payload with a randomly generated key. It converts the actual payload that will be executed into the encoded format and then transmits the encoded form as the payload. The decoder stub is partially randomly generated, with a different but functionally equivalent set of instructions generated each time the encoder is run--hence “polymorphic.” The nondeterministic nature of the decoder helps the encrypted payload avoid being easily identified by electronic fingerprinting. Once the target begins executing code, the decoder converts the encoded payload back into its raw form and then executes it.

There are two major components involved in the development process. The first part is the encoder itself. The encoder is responsible for taking a raw buffer and encoding it into the appropriate format while eliminating potentially invalid characters, such as null characters. The second part is the decoder, which takes the encoded form and converts it back into the raw form so that it can be executed as a payload. This is the polymorphic component of the software.

People using this encoder could range from computer security researchers to commercial penetration testers looking to identify a company’s vulnerabilities. 

**Requirements (Functional)**

As a penetration tester, I want to:

* Test Raspberry Pis and other ARM devices for security.

* Evade system security.

* Create different signatures for binaries at will.

* Be able to reliably target systems of ARM architecture.

* Encrypt my payload with one-way XOR encryption.

* Decode and run and encrypted payload after bypassing the system’s security.

* Attack targets from different systems.

As a federal investigator, I want to:

* Covertly execute code on a criminal’s ARM machine.

* Bypass networking monitoring tools such as snort or bro

As an instructor, I want to:

* Create malware that is difficult for students to detect.

* Create malware that is difficult for students to decode.

As a security researcher, I want to:

* Create pieces of code to test new malware detection programs with.

As a user, I want to:

* Obfuscate code.

* Create a different decoder each time I encrypt a payload.

* Target ARM architectures using Metasploit.

* Hide pieces of code from view.

* Inconspicuously hide my encrypted data.

* Test the strength of different antivirus programs.

**Requirements (Non-Functional)**

As a penetration tester, I want to:

* Reliably output decoder programs that are functionally equivalent.

* Contain my encrypted file in a reasonable amount of disk space.

The encrypted payload should be proportional in size to the unencrypted payload. The major addition in size to the file should be due to the decoder stub, which will be roughly constant in size.

* Get the obfuscated payload to successfully bypass a system’s security.

The encrypted payload should be able to bypass virus detection programs similarly to the existing implementation of the Shikata Ga Nai encoder for x86 architecture.

As a security researcher, I want to:

* Work with clean, easily modified and understood code.

* Ensure that outputted binaries to be securely encoded.

As a developer, I want to:

* Deploy to production or staging with one command.

* Have functionality testing continuously run on the code base.

* Use a multitiered architecture.

* Have a bug tracker that is available to all other developers.

Source code for other encoders in Metasploit is freely available on Github. We wish to ensure that our code is similarly shared.

* Easily implement code in the Metasploit framework.

Current encoders take standard arguments from terminal commands issued in Metasploit. Our program should be able to take inputs of the same format other encryption mechanism use and produce outputs in the same way. It should also handle errors in the same way other encoder would.

